<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Finalizar Pedido | Loja de Perfumes</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box}

body{
  font-family:'Poppins',sans-serif;
  background:#f4f4f4;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}

.checkout{
  background:#fff;
  width:100%;
  max-width:480px;
  padding:32px;
  border-radius:22px;
  box-shadow:0 25px 60px rgba(0,0,0,.15);
}

h2{text-align:center;margin-bottom:16px}

.resumo{
  background:#fafafa;
  border-radius:14px;
  padding:14px;
  margin-bottom:18px;
  border:1px solid #eee;
}

.item{
  display:flex;
  justify-content:space-between;
  font-size:14px;
  margin-bottom:6px;
}

.total{
  border-top:1px solid #ddd;
  margin-top:8px;
  padding-top:8px;
  text-align:right;
  font-weight:600;
}

label{
  font-size:14px;
  margin-top:12px;
  display:block;
}

input,select{
  width:100%;
  padding:14px;
  margin-top:5px;
  border-radius:14px;
  border:1px solid #ddd;
}

input:focus,select:focus{
  outline:none;
  border-color:#25D366;
}

.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}

.btn{
  width:100%;
  margin-top:22px;
  padding:16px;
  background:#25D366;
  color:#fff;
  border:none;
  border-radius:16px;
  font-size:16px;
  cursor:pointer;
}

.mini{
  margin-top:10px;
  font-size:12px;
  color:#777;
  text-align:center;
}

.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.55);
  display:none;
  align-items:center;
  justify-content:center;
}

.overlay.active{display:flex}

.box{
  background:#fff;
  padding:26px;
  border-radius:18px;
  text-align:center;
}

.loader{
  width:40px;
  height:40px;
  border:4px solid #eee;
  border-top-color:#25D366;
  border-radius:50%;
  margin:0 auto 12px;
  animation:spin 1s linear infinite;
}

@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body>

<div class="checkout">

<h2>Confirmar Pedido</h2>

<div class="resumo">
  <div id="produtos"></div>
  <div class="total">Total: R$ <span id="total">0</span></div>
</div>

<label>Nome completo *</label>
<input id="nome" required>

<label>CEP *</label>
<input id="cep" maxlength="9" onblur="buscarCEP()">

<label>Rua</label>
<input id="rua" readonly>

<div class="grid">
  <input id="numero" placeholder="N√∫mero *">
  <input id="bairro" placeholder="Bairro" readonly>
</div>

<div class="grid">
  <input id="cidade" placeholder="Cidade" readonly>
  <input id="estado" placeholder="Estado" readonly>
</div>

<label>Forma de pagamento *</label>
<select id="pagamento">
  <option value="">Selecione</option>
  <option>Pix</option>
  <option>Cr√©dito</option>
  <option>D√©bito</option>
</select>

<button class="btn" onclick="enviarPedido()">
Enviar pedido via WhatsApp
</button>

<div class="mini">
Confirme a mensagem no WhatsApp e aguarde nosso atendimento.
</div>

</div>

<div id="overlay" class="overlay">
  <div class="box">
    <div class="loader"></div>
    <p>Finalizando envio via WhatsApp‚Ä¶<br><strong>Aguarde nosso atendimento</strong></p>
  </div>
</div>

<script>
// ===== CARRINHO =====
const carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];
const produtosEl = document.getElementById("produtos");
const totalEl = document.getElementById("total");
let total = 0;

carrinho.forEach(p=>{
  total += p.preco;
  produtosEl.innerHTML += `
    <div class="item">
      <span>${p.nome}</span>
      <strong>R$ ${p.preco}</strong>
    </div>`;
});
totalEl.innerText = total;

// ===== BUSCAR CEP =====
function buscarCEP(){
  const cep = document.getElementById("cep").value.replace(/\D/g,'');
  if(cep.length !== 8) return;

  fetch(`https://viacep.com.br/ws/${cep}/json/`)
  .then(res=>res.json())
  .then(data=>{
    if(!data.erro){
      document.getElementById("rua").value = data.logradouro;
      document.getElementById("bairro").value = data.bairro;
      document.getElementById("cidade").value = data.localidade;
      document.getElementById("estado").value = data.uf;
    }
  });
}

// ===== ENVIO WHATS =====
function enviarPedido(){
  const nome = document.getElementById("nome").value.trim();
  const telefone = document.getElementById("telefone").value;
  const cep = document.getElementById("cep").value;
  const rua = document.getElementById("rua").value;
  const numero = document.getElementById("numero").value;
  const bairro = document.getElementById("bairro").value;
  const cidade = document.getElementById("cidade").value;
  const estado = document.getElementById("estado").value;
  const pagamento = document.getElementById("pagamento").value;

  if(!nome || !numero || !pagamento){
    alert("Preencha nome, n√∫mero e pagamento");
    return;
  }

  let msg =
`üü¢ *NOVO PEDIDO*

üë§ Cliente: ${nome}
üìû WhatsApp: ${telefone}

üìç Endere√ßo:
${rua}, N¬∫ ${numero}
${bairro} - ${cidade}/${estado}
CEP: ${cep}

üì¶ Produtos:`;

  carrinho.forEach(p=>{
    msg += `\n- ${p.nome} (R$ ${p.preco})`;
  });

  msg += `

üí∞ Total: R$ ${total}
üí≥ Pagamento: ${pagamento}

üìå Aguardando confirma√ß√£o.`;

  document.getElementById("overlay").classList.add("active");

  setTimeout(()=>{
    window.location.href =
"https://wa.me/5511980854714?text=" + encodeURIComponent(msg);
  },1500);
}
</script>

</body>
</html>


